<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Unblockedcord</title>
  <script type="text/javascript" src="https://cdn.scaledrone.com/scaledrone.min.js"></script>
  <style>
    /* ==== Styles omitted for brevity ====
         Keep all your CSS from your previous version */
  </style>
</head>
<body>
  <!-- Connection Status -->
  <div id="connectionStatus" class="connection-status disconnected">Connecting...</div>

  <!-- Server Sidebar -->
  <div class="server-sidebar">
    <a href="index.html" class="server-icon" title="Home">
      <img src="https://img.icons8.com/ios-filled/50/ffffff/discord-logo.png" alt="Discord Logo"/>
    </a>
    <div class="separator"></div>
    <a href="main.html" class="nav-icon" title="Home"><img src="https://img.icons8.com/ios-filled/50/ffffff/home.png"/></a>
    <a href="g.html" class="nav-icon" title="Games"><img src="https://img.icons8.com/ios-filled/50/ffffff/controller.png"/></a>
    <a href="a.html" class="nav-icon" title="Apps"><img src="https://img.icons8.com/ios-filled/50/ffffff/app-store.png"/></a>
    <a href="e.html" class="nav-icon" title="Exploits"><img src="https://img.icons8.com/ios-filled/50/ffffff/hacker.png"/></a>
    <a href="s.html" class="nav-icon" title="Settings"><img src="https://img.icons8.com/ios-filled/50/ffffff/settings.png"/></a>
    <a href="disremake.html" class="nav-icon" title="Chat"><img src="https://img.icons8.com/ios-filled/50/ffffff/chat.png"/></a>
  </div>

  <!-- Channel Sidebar -->
  <div class="channel-sidebar">
    <div class="server-header">Unblockedcord</div>
    <div class="channels-container">
      <div class="channel-category"><span>Text Channels</span><span>+</span></div>
      <div class="channel-item active">general</div>
      <div class="channel-item">random</div>
      <div class="channel-item">memes</div>
      <div class="channel-members">
        <div class="members-info"><span class="members-count">0 users in room:</span></div>
        <div class="members-list"></div>
      </div>
    </div>
    <div class="user-info">
      <div class="user-avatar" id="userAvatar">U</div>
      <div class="user-details">
        <div class="user-name" id="userName">Connecting...</div>
        <div class="user-status" id="userStatus">Offline</div>
      </div>
    </div>
  </div>

  <!-- Chat Container -->
  <div class="chat-container">
    <div class="chat-header">
      <div class="chat-header-left"><span class="channel-name">general</span></div>
      <div class="chat-header-right"><span class="members-count-header">0 members</span></div>
    </div>
    <div class="messages-container messages"></div>
    <div class="message-input-container">
      <form class="message-form" onsubmit="return false;">
        <input id="messageInput" class="message-input message-form__input" placeholder="Type a message..." type="text"/>
        <button class="send-button message-form__button" type="submit" disabled>Send</button>
      </form>
    </div>
  </div>

  <!-- Members Sidebar -->
  <div class="members-sidebar">
    <div class="members-header"><span>Members â€” <span class="members-count-sidebar">0</span></span></div>
    <div class="members-content">
      <div class="members-section">
        <div class="members-section-title">Online â€” <span class="online-count">0</span></div>
        <div class="members-list-sidebar"></div>
      </div>
    </div>
  </div>

<script>
/**************************************************************************
 * Full real-time Discord remake with:
 * - Multi-room chat
 * - Scaledrone real-time
 * - LocalStorage chat history per room
 * - Members sidebar
 * - Owner hidden area
 * - Update log popup
**************************************************************************/

const CLIENT_ID = 'hWmT5ZuGe51IgiMD';
const OWNER_AREA = { right: 2, bottom: 2, width: 8, height: 8 };
const OWNER_REQUIRED_CLICKS = 20;
const OWNER_STORAGE_KEY = 'jerichoOwnerUnlocked';
const CHAT_STORAGE_KEY_BASE = 'unblockedcord_chat_history';

let currentRoomName = 'general';
let drone = null;
let currentRoom = null;
let members = [];
let currentUser = null;

const DOM = {
  messages: document.querySelector('.messages'),
  input: document.querySelector('#messageInput'),
  form: document.querySelector('.message-form'),
  sendButton: document.querySelector('.message-form__button'),
  connectionStatus: document.getElementById('connectionStatus'),
  userName: document.getElementById('userName'),
  userAvatar: document.getElementById('userAvatar'),
  userStatus: document.getElementById('userStatus'),
  membersCount: document.querySelector('.members-count'),
  membersList: document.querySelector('.members-list'),
  membersListSidebar: document.querySelector('.members-list-sidebar'),
  membersCountHeader: document.querySelector('.members-count-header'),
  membersCountSidebar: document.querySelector('.members-count-sidebar'),
  onlineCount: document.querySelector('.online-count'),
  channelName: document.querySelector('.channel-name'),
};

// ===== Owner Unlock Hidden Area =====
function createInvisibleOwnerArea() {
  const area = document.createElement('div');
  Object.assign(area.style, {
    position: 'fixed', right: OWNER_AREA.right+'px', bottom: OWNER_AREA.bottom+'px',
    width: OWNER_AREA.width+'px', height: OWNER_AREA.height+'px',
    zIndex: 99999, background: 'transparent', cursor: 'pointer'
  });
  let clicks = 0;
  area.addEventListener('click', () => {
    clicks++;
    if (clicks >= OWNER_REQUIRED_CLICKS) {
      localStorage.setItem(OWNER_STORAGE_KEY, '1');
      alert('Owner unlocked: Owner/Jericho');
      location.reload();
    }
  });
  document.body.appendChild(area);
}
createInvisibleOwnerArea();
function isOwnerUnlocked() { return localStorage.getItem(OWNER_STORAGE_KEY) === '1'; }

// ===== Utility Functions =====
function getRoomStorageKey(roomName){ return CHAT_STORAGE_KEY_BASE+'_'+roomName; }
function getRandomName(){ const adj=["autumn","hidden","bitter","misty","silent"], noun=["waterfall","river","breeze","moon","rain"]; return adj[Math.floor(Math.random()*adj.length)]+'_'+noun[Math.floor(Math.random()*noun.length)]; }
function getRandomColor(){ let c=Math.floor(Math.random()*0xFFFFFF).toString(16); while(c.length<6)c='0'+c; return '#'+c; }
function updateConnectionStatus(status){
  DOM.connectionStatus.textContent = status;
  DOM.connectionStatus.className = 'connection-status '+(status==='Connected'?'connected':'disconnected');
  DOM.sendButton.disabled = status!=='Connected';
  DOM.userStatus.textContent = status==='Connected'?'Online':'Offline';
}

// ===== Message DOM =====
function createMessageElement(text, authorName, color, isoTime){
  const messageEl = document.createElement('div'); messageEl.className='message';
  const avatarEl=document.createElement('div'); avatarEl.className='message-avatar';
  avatarEl.style.backgroundColor=color||'#5865F2'; avatarEl.textContent=(authorName?authorName.charAt(0).toUpperCase():'?');
  const contentEl=document.createElement('div'); contentEl.className='message-content';
  const headerEl=document.createElement('div'); headerEl.className='message-header';
  const authorEl=document.createElement('span'); authorEl.className='message-author'; authorEl.style.color=color||'#DCDDDE'; authorEl.textContent=authorName||'Unknown';
  if(authorName==='Owner/Jericho') authorEl.textContent+=' ðŸ‘‘';
  const timestampEl=document.createElement('span'); timestampEl.className='message-timestamp';
  timestampEl.textContent = isoTime ? new Date(isoTime).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}) : new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
  const textEl=document.createElement('div'); textEl.className='message-text'; textEl.textContent=text;
  headerEl.appendChild(authorEl); headerEl.appendChild(timestampEl); contentEl.appendChild(headerEl); contentEl.appendChild(textEl);
  messageEl.appendChild(avatarEl); messageEl.appendChild(contentEl); return messageEl;
}
function addMessageToListDOM(text, authorName, color, isoTime){
  const atBottom = DOM.messages.scrollTop >= (DOM.messages.scrollHeight - DOM.messages.clientHeight - 20);
  DOM.messages.appendChild(createMessageElement(text, authorName, color, isoTime));
  if(atBottom) DOM.messages.scrollTop = DOM.messages.scrollHeight - DOM.messages.clientHeight;
}

// ===== LocalStorage per-room =====
function saveMessageToLocal(text, name, color, roomName, isoTime){
  try{ const key=getRoomStorageKey(roomName); const history=JSON.parse(localStorage.getItem(key)||'[]'); history.push({text,name,color,time:isoTime||new Date().toISOString()}); localStorage.setItem(key,JSON.stringify(history)); }
  catch(e){ console.error(e); }
}
function loadChatHistoryForRoom(roomName){ 
  DOM.messages.innerHTML=''; 
  const key=getRoomStorageKey(roomName); const history=JSON.parse(localStorage.getItem(key)||'[]');
  history.forEach(item=>addMessageToListDOM(item.text,item.name,item.color,item.time));
}

// ===== Members DOM =====
function createMemberSidebarElement(member){
  const name=(member.clientData&&member.clientData.name)||'Unknown';
  const color=(member.clientData&&member.clientData.color)||'#5865F2';
  const memberEl=document.createElement('div'); memberEl.className='member-item';
  const avatarEl=document.createElement('div'); avatarEl.className='member-avatar'; avatarEl.style.backgroundColor=color; avatarEl.textContent=name.charAt(0).toUpperCase();
  const infoEl=document.createElement('div'); infoEl.className='member-info';
  const nameEl=document.createElement('div'); nameEl.className='member-name'; nameEl.textContent=name;
  if(name==='Owner/Jericho'){ const crown=document.createElement('span'); crown.textContent=' ðŸ‘‘'; crown.style.marginLeft='6px'; nameEl.appendChild(crown); }
  const statusEl=document.createElement('div'); statusEl.className='member-status'; statusEl.textContent='Online';
  infoEl.appendChild(nameEl); infoEl.appendChild(statusEl);
  memberEl.appendChild(avatarEl); memberEl.appendChild(infoEl);
  return memberEl;
}
function updateMembersDOM(){
  DOM.membersList.innerHTML=''; DOM.membersListSidebar.innerHTML='';
  members.forEach(m=>{ DOM.membersListSidebar.appendChild(createMemberSidebarElement(m)); const el=document.createElement('div'); el.className='member'; el.textContent=(m.clientData&&m.clientData.name)||'Unknown'; DOM.membersList.appendChild(el); });
  const count=members.length;
  DOM.membersCount.textContent=`${count} users in room:`; DOM.membersCountHeader.textContent=`${count} member${count!==1?'s':''}`; DOM.membersCountSidebar.textContent=count; DOM.onlineCount.textContent=count;
}

// ===== Scaledrone =====
function initializeScaledroneAndJoin(){
  const ownerMode=isOwnerUnlocked();
  currentUser=ownerMode?{name:'Owner/Jericho',color:'#f04747'}:{name:getRandomName(),color:getRandomColor()};
  DOM.userName.textContent=currentUser.name; DOM.userAvatar.textContent=currentUser.name.charAt(0).toUpperCase(); DOM.userAvatar.style.backgroundColor=currentUser.color;
  drone=new ScaleDrone(CLIENT_ID,{data:currentUser});
  drone.on('open', err=>{ if(err){ console.error(err); updateConnectionStatus('Error'); return; } updateConnectionStatus('Connected'); joinRoom(currentRoomName); });
  drone.on('close', ()=>updateConnectionStatus('Disconnected'));
  drone.on('error', ()=>updateConnectionStatus('Error'));
}
function joinRoom(roomName){
  if(currentRoom&&typeof currentRoom.unsubscribe==='function') currentRoom.unsubscribe();
  DOM.channelName.textContent=roomName; loadChatHistoryForRoom(roomName);
  members=[]; updateMembersDOM();
  currentRoom=drone.subscribe('observable-'+roomName);
  currentRoom.on('open', err=>{if(err) console.error(err);});
  currentRoom.on('members', m=>{ members=m; updateMembersDOM(); });
  currentRoom.on('member_join', member=>{ members.push(member); updateMembersDOM(); });
  currentRoom.on('member_leave', ({id})=>{ const i=members.findIndex(x=>x.id===id); if(i!==-1) members.splice(i,1); updateMembersDOM(); });
  currentRoom.on('data',(message,member)=>{ if(!member) return; const name=(member.clientData&&member.clientData.name)||'Someone'; const color=(member.clientData&&member.clientData.color)||'#5865F2'; addMessageToListDOM(message,name,color,new Date().toISOString()); saveMessageToLocal(message,name,color,roomName,new Date().toISOString()); });
}

// ===== Send Messages =====
function sendMessage(){
  const value=DOM.input.value.trim(); if(!value||!drone||!currentRoom) return;
  DOM.input.value='';
  drone.publish({room:'observable-'+currentRoomName,message:value});
}
DOM.form.addEventListener('submit', e=>{ e.preventDefault(); sendMessage(); });
DOM.input.addEventListener('keypress', e=>{ if(e.key==='Enter') sendMessage(); });

// ===== Channel Switching =====
document.querySelectorAll('.channel-item').forEach(it=>{
  it.addEventListener('click', ()=>{
    if(it.classList.contains('active')) return;
    document.querySelectorAll('.channel-item').forEach(x=>x.classList.remove('active'));
    it.classList.add('active');
    currentRoomName=it.textContent.trim();
    joinRoom(currentRoomName);
  });
});

// ===== On load =====
window.addEventListener('load', ()=>{
  initializeScaledroneAndJoin();
  loadChatHistoryForRoom(currentRoomName);
});
</script>
</body>
</html>
