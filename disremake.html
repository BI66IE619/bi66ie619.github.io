<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Unblockedcord</title>
  <script type='text/javascript' src='https://cdn.scaledrone.com/scaledrone.min.js'></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { display: flex; height: 100vh; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #36393F; color: white; overflow: hidden; }
    .server-sidebar { width: 72px; background-color: #1f1e23; padding: 12px 8px; display: flex; flex-direction: column; align-items: center; gap: 8px; }
    .server-icon { width: 48px; height: 48px; background-color: #5865F2; border-radius: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: border-radius 0.2s ease; position: relative; }
    .server-icon:hover { border-radius: 16px; }
    .server-icon img { width: 28px; height: 28px; border-radius: 50%; }
    .separator { width: 32px; height: 2px; background-color: #4F545C; border-radius: 1px; margin: 4px 0; }
    .nav-icon { width: 48px; height: 48px; background-color: #36393F; border-radius: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s ease; }
    .nav-icon:hover { background-color: #5865F2; border-radius: 16px; }
    .nav-icon img { width: 20px; height: 20px; filter: invert(1); }
    .channel-sidebar { width: 240px; background-color: #2c2d31; display: flex; flex-direction: column; }
    .server-header { height: 48px; padding: 0 16px; display: flex; align-items: center; border-bottom: 1px solid #1e1f22; font-weight: 600; cursor: pointer; }
    .server-header:hover { background-color: #35373C; }
    .channels-container { flex: 1; padding: 16px 8px; overflow-y: auto; }
    .channel-category { display: flex; align-items: center; justify-content: space-between; padding: 16px 8px 4px 8px; font-size: 12px; font-weight: 600; color: #96989D; text-transform: uppercase; letter-spacing: 0.02em; }
    .channel-item { display: flex; align-items: center; padding: 6px 8px; margin: 1px 0; border-radius: 4px; cursor: pointer; color: #96989D; transition: all 0.15s ease; }
    .channel-item:hover { background-color: #35373C; color: #DCDDDE; }
    .channel-item.active { background-color: #404249; color: white; }
    .channel-item::before { content: '#'; margin-right: 6px; font-weight: 300; }
    .user-info { height: 52px; background-color: #232428; padding: 8px; display: flex; align-items: center; gap: 8px; }
    .user-avatar { width: 32px; height: 32px; border-radius: 50%; background-color: #5865F2; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; }
    .user-details { flex: 1; min-width: 0; }
    .user-name { font-size: 14px; font-weight: 600; color: white; line-height: 18px; }
    .user-status { font-size: 12px; color: #96989D; line-height: 16px; }
    .chat-container { flex: 1; background-color: #36393F; display: flex; flex-direction: column; }
    .chat-header { height: 48px; padding: 0 16px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #1e1f22; gap: 8px; }
    .chat-header-left { display: flex; align-items: center; gap: 8px; }
    .chat-header-right { font-size: 14px; color: #96989D; }
    .chat-header::before { content: '#'; color: #96989D; font-weight: 300; }
    .channel-name { font-weight: 600; color: white; }
    .messages-container { flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 4px; }
    .message { display: flex; gap: 16px; padding: 2px 0; margin: 4px 0; border-radius: 4px; transition: background-color 0.1s ease; }
    .message:hover { background-color: #32353B; }
    .message-avatar { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 16px; flex-shrink: 0; margin-top: 2px; }
    .message-content { flex: 1; min-width: 0; }
    .message-header { display: flex; align-items: baseline; gap: 8px; margin-bottom: 2px; }
    .message-author { font-weight: 500; font-size: 16px; cursor: pointer; }
    .message-author:hover { text-decoration: underline; }
    .message-timestamp { font-size: 12px; color: #96989D; font-weight: 500; }
    .message-text { font-size: 16px; line-height: 22px; color: #DCDDDE; word-wrap: break-word; }
    .message-input-container { padding: 16px; }
    .message-form { background-color: #40444B; border-radius: 8px; padding: 11px 16px; display: flex; align-items: center; gap: 12px; }
    .message-input { flex: 1; background: transparent; border: none; color: white; font-size: 16px; line-height: 22px; resize: none; outline: none; }
    .message-input::placeholder { color: #96989D; }
    .send-button { background-color: #5865F2; color: white; border: none; border-radius: 6px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer; transition: background-color 0.15s ease; }
    .send-button:hover { background-color: #4752C4; }
    .send-button:disabled { background-color: #36393F; cursor: not-allowed; opacity: 0.5; }
    .members-sidebar { width: 240px; background-color: #2c2d31; display: flex; flex-direction: column; border-left: 1px solid #1e1f22; }
    .members-header { height: 48px; padding: 0 16px; display: flex; align-items: center; border-bottom: 1px solid #1e1f22; font-weight: 600; color: white; }
    .members-content { flex: 1; overflow-y: auto; padding: 16px 8px; }
    .members-section { margin-bottom: 24px; }
    .members-section-title { font-size: 12px; font-weight: 600; color: #96989D; text-transform: uppercase; letter-spacing: 0.02em; margin-bottom: 8px; padding: 0 8px; }
    .member-item { display: flex; align-items: center; padding: 2px 8px; margin: 1px 0; border-radius: 4px; cursor: pointer; transition: background-color 0.15s ease; }
    .member-item:hover { background-color: #35373C; }
    .member-avatar { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; margin-right: 12px; position: relative; }
    .member-avatar::after { content: ''; position: absolute; bottom: -2px; right: -2px; width: 12px; height: 12px; background-color: #3ba55c; border: 3px solid #2c2d31; border-radius: 50%; }
    .member-info { flex: 1; min-width: 0; }
    .member-name { font-size: 14px; font-weight: 500; color: white; line-height: 18px; }
    .member-status { font-size: 12px; color: #96989D; line-height: 16px; }
    .members-info { font-size: 12px; color: #96989D; margin-bottom: 8px; padding: 0 8px; }
    .members-list { max-height: 200px; overflow-y: auto; padding: 0 8px; }
    .member { padding: 2px 0; font-size: 14px; font-weight: 500; }
    @media (max-width: 1024px) { .members-sidebar { display: none; } .channel-members { display: block; } }
    @media (min-width: 1025px) { .channel-members { display: none; } .members-sidebar { display: flex; } }
    @media (max-width: 768px) { .server-sidebar { width: 60px; padding: 8px 4px; } .server-icon, .nav-icon { width: 40px; height: 40px; } .channel-sidebar { width: 200px; } .message-form { padding: 8px 12px; } .message-input { font-size: 14px; } }
    @media (max-width: 480px) { .server-sidebar { width: 50px; padding: 6px 2px; } .server-icon, .nav-icon { width: 36px; height: 36px; } .channel-sidebar { width: 180px; } .chat-header { padding: 0 12px; } .messages-container { padding: 12px; } .message-input-container { padding: 12px; } }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background-color: #1a1a1a; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background-color: #2a2a2a; }
    .connection-status { position: fixed; top: 10px; right: 10px; padding: 8px 12px; border-radius: 4px; font-size: 12px; font-weight: 500; z-index: 1000; }
    .connection-status.connected { background-color: #3ba55c; color: white; }
    .connection-status.disconnected { background-color: #ed4245; color: white; }

    /* tiny invisible hint area (debug outline if you need it) */
    #owner-invisible-area { /* styling applied dynamically by JS */ }

    /* typing indicator style */
    .typing-indicator {
      font-style: italic;
      font-size: 13px;
      color: #b9bbbe;
      margin: 6px 0 0 10px;
      min-height: 18px;
    }
  </style>
</head>
<body>
  <!-- Connection Status -->
  <div id="connectionStatus" class="connection-status disconnected">Connecting...</div>

  <!-- Server Sidebar -->
  <div class="server-sidebar">
    <div class="server-icon">
      <img src="https://files.catbox.moe/uf0zh5.png" alt="Discord Logo"/>
    </div>
    <div class="separator"></div>
    <div class="nav-icon"><img src="https://img.icons8.com/ios-filled/50/FFFFFF/home.png" alt="Home"></div>
    <div class="nav-icon"><img src="https://static-00.iconduck.com/assets.00/console-controller-icon-2048x2048-pmmusn7m.png" alt="Games"></div>
    <div class="nav-icon"><img src="https://img.icons8.com/ios7/600/FFFFFF/apple-app-store--v2.png" alt="Apps"></div>
    <div class="nav-icon"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT0_6HUhLshuftA_sDchc5pEGqTBPa41EO6Xw&s" alt="Exploits"></div>
    <div class="nav-icon"><img src="https://img.icons8.com/m_rounded/512/FFFFFF/settings.png" alt="Settings"></div>
    <div class="nav-icon"><img src="https://files.catbox.moe/uf0zh5.png" alt="Chat"></div>
  </div>

  <!-- Channel Sidebar -->
  <div class="channel-sidebar">
    <div class="server-header">Unblockedcord</div>
    <div class="channels-container">
      <div class="channel-category"><span>Text Channels</span><span>+</span></div>
      <div class="channel-item active">general</div>
      <div class="channel-item">random</div>
      <div class="channel-item">memes</div>
      <div class="channel-members">
        <div class="members-info"><span class="members-count">0 users in room:</span></div>
        <div class="members-list"></div>
      </div>
    </div>
    <div class="user-info">
      <div class="user-avatar" id="userAvatar">U</div>
      <div class="user-details">
        <div class="user-name" id="userName">Connecting...</div>
        <div class="user-status" id="userStatus">Offline</div>
      </div>
    </div>
  </div>

  <!-- Chat Container -->
  <div class="chat-container">
    <div class="chat-header">
      <div class="chat-header-left"><span class="channel-name">general</span></div>
      <div class="chat-header-right"><span class="members-count-header">0 members</span></div>
    </div>
    <div class="messages-container messages"></div>
    <!-- typing indicator will be appended into .messages by JS -->
    <div class="message-input-container">
      <form class="message-form" onsubmit="return false;">
        <input id="messageInput" class="message-input message-form__input" placeholder="Type a message..." type="text"/>
        <button class="send-button message-form__button" type="submit" disabled>Send</button>
      </form>
    </div>
  </div>

  <!-- Members Sidebar -->
  <div class="members-sidebar">
    <div class="members-header"><span>Members — <span class="members-count-sidebar">0</span></span></div>
    <div class="members-content">
      <div class="members-section">
        <div class="members-section-title">Online — <span class="online-count">0</span></div>
        <div class="members-list-sidebar"></div>
      </div>
    </div>
  </div>

 <script>
  const OWNER_AREA = { right: 2, bottom: 2, width: 8, height: 8 };
  const OWNER_REQUIRED_CLICKS = 20;
  const OWNER_STORAGE_KEY = 'jerichoOwnerUnlocked';
  const CHAT_STORAGE_KEY = 'unblockedcord_chat_history';

  function createInvisibleOwnerArea() {
    const area = document.createElement('div');
    Object.assign(area.style, {
      position: 'fixed',
      right: OWNER_AREA.right + 'px',
      bottom: OWNER_AREA.bottom + 'px',
      width: OWNER_AREA.width + 'px',
      height: OWNER_AREA.height + 'px',
      background: 'transparent',
      cursor: 'pointer',
      zIndex: 99999,
    });
    let clicks = 0;
    area.addEventListener('click', () => {
      clicks++;
      if (clicks >= OWNER_REQUIRED_CLICKS) {
        localStorage.setItem(OWNER_STORAGE_KEY, '1');
        alert('Owner unlocked. You are now recognized as Owner/Jericho.');
        location.reload();
      }
    });
    document.body.appendChild(area);
  }
  function isOwnerUnlocked() {
    return localStorage.getItem(OWNER_STORAGE_KEY) === '1';
  }

  createInvisibleOwnerArea();

  // --- Chat setup ---
  const CLIENT_ID = 'hWmT5ZuGe51IgiMD';
  let drone, room;
  let members = [];
  let typingUsers = new Set();
  let typingTimeout;

  const DOM = {
    messages: document.querySelector('.messages'),
    input: document.querySelector('.message-form__input'),
    form: document.querySelector('.message-form'),
    sendButton: document.querySelector('.message-form__button'),
    connectionStatus: document.getElementById('connectionStatus'),
    chatHeader: document.querySelector('.chat-header'),
    userName: document.getElementById('userName'),
    userAvatar: document.getElementById('userAvatar'),
    userStatus: document.getElementById('userStatus'),
    membersListSidebar: document.querySelector('.members-list-sidebar'),
  };

  // --- clear chat button ---
  const clearBtn = document.createElement('button');
  clearBtn.textContent = '🗑️ Clear Chat';
  clearBtn.style.background = 'none';
  clearBtn.style.border = 'none';
  clearBtn.style.color = '#ED4245';
  clearBtn.style.fontWeight = '600';
  clearBtn.style.cursor = 'pointer';
  clearBtn.addEventListener('click', clearChatHistory);
  DOM.chatHeader.appendChild(clearBtn);

  // --- typing indicator display ---
  const typingIndicator = document.createElement('div');
  typingIndicator.id = 'typingIndicator';
  typingIndicator.style.fontSize = '13px';
  typingIndicator.style.color = '#bbb';
  typingIndicator.style.margin = '6px 10px';
  DOM.messages.after(typingIndicator);

  function getRandomName() {
    const a = ["quiet","blue","silent","misty","frosty","bitter","soft","cold","gentle","bold"];
    const n = ["moon","leaf","wave","breeze","shadow","field","stone","cloud","forest","river"];
    return a[Math.floor(Math.random()*a.length)] + "_" + n[Math.floor(Math.random()*n.length)];
  }
  function getRandomColor() {
    let c = Math.floor(Math.random() * 0xFFFFFF).toString(16);
    while (c.length < 6) c = '0' + c;
    return '#' + c;
  }

  let currentUser = isOwnerUnlocked()
    ? { name: 'Owner/Jericho', color: '#f04747' }
    : { name: getRandomName(), color: getRandomColor() };

  DOM.userName.textContent = currentUser.name;
  DOM.userAvatar.textContent = currentUser.name[0].toUpperCase();
  DOM.userAvatar.style.backgroundColor = currentUser.color;

  function updateConnectionStatus(status) {
    DOM.connectionStatus.textContent = status;
    DOM.connectionStatus.className = `connection-status ${status === 'Connected' ? 'connected' : 'disconnected'}`;
  }

  // --- localStorage chat ---
  function saveMessageToLocal(text, member) {
    const history = JSON.parse(localStorage.getItem(CHAT_STORAGE_KEY) || '[]');
    history.push({ text, member });
    localStorage.setItem(CHAT_STORAGE_KEY, JSON.stringify(history));
  }
  function loadChatHistory() {
    const history = JSON.parse(localStorage.getItem(CHAT_STORAGE_KEY) || '[]');
    history.forEach(({ text, member }) => addMessageToListDOM(text, member));
  }
  function clearChatHistory() {
    if (confirm('Clear all local chat history?')) {
      localStorage.removeItem(CHAT_STORAGE_KEY);
      DOM.messages.innerHTML = '';
    }
  }

  // --- connect to Scaledrone ---
  function initChat() {
    loadChatHistory();
    drone = new ScaleDrone(CLIENT_ID, { data: currentUser });

    drone.on('open', error => {
      if (error) {
        updateConnectionStatus('Error');
        return console.error(error);
      }
      updateConnectionStatus('Connected');
      room = drone.subscribe('observable-room');

      room.on('members', m => { members = m; updateMembers(); });
      room.on('member_join', m => { members.push(m); updateMembers(); });
      room.on('member_leave', ({id}) => {
        members = members.filter(mem => mem.id !== id);
        updateMembers();
      });
      room.on('data', (data, member) => {
        if (!member) return;
        if (data.type === 'message') {
          addMessageToListDOM(data.text, member);
          saveMessageToLocal(data.text, member);
        } else if (data.type === 'typing') {
          handleTyping(member, data.isTyping);
        }
      });
    });

    drone.on('close', () => updateConnectionStatus('Disconnected'));
    drone.on('error', () => updateConnectionStatus('Error'));
  }

  function handleTyping(member, isTyping) {
    if (isTyping) typingUsers.add(member.clientData.name);
    else typingUsers.delete(member.clientData.name);
    updateTypingIndicator();
  }

  function updateTypingIndicator() {
    if (typingUsers.size === 0) {
      typingIndicator.textContent = '';
      return;
    }
    const names = Array.from(typingUsers);
    typingIndicator.textContent =
      names.length === 1
        ? `${names[0]} is typing...`
        : `${names.join(', ')} are typing...`;
  }

  function sendTypingStatus(isTyping) {
    if (room && drone) {
      room.publish({ type: 'typing', isTyping });
    }
  }

  // typing detection
  DOM.input.addEventListener('input', () => {
    clearTimeout(typingTimeout);
    sendTypingStatus(true);
    typingTimeout = setTimeout(() => sendTypingStatus(false), 2000);
  });

  DOM.form.addEventListener('submit', e => {
    e.preventDefault();
    const value = DOM.input.value.trim();
    if (value === '') return;
    sendTypingStatus(false);
    DOM.input.value = '';
    drone.publish({ room: 'observable-room', message: { type: 'message', text: value } });
  });

  function createMessageElement(text, member) {
    const { name, color } = member.clientData;
    const messageEl = document.createElement('div');
    messageEl.className = 'message';
    const avatar = document.createElement('div');
    avatar.className = 'message-avatar';
    avatar.style.backgroundColor = color;
    avatar.textContent = name[0].toUpperCase();
    const content = document.createElement('div');
    content.className = 'message-content';
    const header = document.createElement('div');
    header.className = 'message-header';
    const author = document.createElement('span');
    author.className = 'message-author';
    author.style.color = color;
    author.textContent = name + (name === 'Owner/Jericho' ? ' 👑' : '');
    const time = document.createElement('span');
    time.className = 'message-timestamp';
    time.textContent = new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    const msgText = document.createElement('div');
    msgText.className = 'message-text';
    msgText.textContent = text;
    header.append(author, time);
    content.append(header, msgText);
    messageEl.append(avatar, content);
    return messageEl;
  }

  function addMessageToListDOM(text, member) {
    const el = DOM.messages;
    const atBottom = el.scrollTop >= el.scrollHeight - el.clientHeight - 5;
    el.appendChild(createMessageElement(text, member));
    if (atBottom) el.scrollTop = el.scrollHeight;
  }

  function updateMembers() {
    DOM.membersListSidebar.innerHTML = '';
    members.forEach(m => {
      const div = document.createElement('div');
      div.textContent = m.clientData.name + (m.clientData.name === 'Owner/Jericho' ? ' 👑' : '');
      div.style.color = m.clientData.color;
      DOM.membersListSidebar.appendChild(div);
    });
  }

  window.addEventListener('load', initChat);
</script>
