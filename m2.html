<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bi6Streamz</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #121212; color: #eee; }
        #search { padding: 15px; width: 100%; max-width: 600px; box-sizing: border-box; margin-bottom: 20px; border: none; border-radius: 4px; background: #333; color: white; }
        #results { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 25px; }
        .poster { width: 100%; aspect-ratio: 2/3; object-fit: cover; border-radius: 8px; cursor: pointer; transition: transform 0.2s; }
        .poster:hover { transform: scale(1.05); }
        .title { margin-top: 10px; font-size: 0.9em; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        #player { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 1000; }
        #videoContainer { position: relative; width: 80%; max-width: 900px; }
        #closePlayer { position: absolute; top: -40px; right: 0; background: red; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; }
        #videoPlayer { width: 100%; height: auto; outline: none; }
    </style>
</head>
<body>
    <h1>OMDB Stream</h1>
    <input type="text" id="search" placeholder="Search for any movie or TV show..." autocomplete="off">
    <div id="results"></div>

    <div id="player">
        <div id="videoContainer">
            <button id="closePlayer">Close</button>
            <video id="videoPlayer" controls></video>
        </div>
    </div>

    <script>
        const API_KEY = '2f865358'; // REPLACE THIS WITH YOUR KEY FROM OMDBAPI.COM
        const OMDB_URL = 'https://www.omdbapi.com/';

        const searchInput = document.getElementById('search');
        const resultsContainer = document.getElementById('results');
        const player = document.getElementById('player');
        const videoPlayer = document.getElementById('videoPlayer');
        const closePlayer = document.getElementById('closePlayer');

        // Search when user types
        searchInput.addEventListener('input', debounce(() => {
            const query = searchInput.value.trim();
            if (query) {
                searchContent(query);
            } else {
                resultsContainer.innerHTML = '';
            }
        }, 500));

        closePlayer.addEventListener('click', () => {
            player.style.display = 'none';
            videoPlayer.pause();
            videoPlayer.src = '';
        });

        // Function to search for content using OMDB API
        async function searchContent(query) {
            try {
                const response = await fetch(`${OMDB_URL}?apikey=${API_KEY}&s=${encodeURIComponent(query)}&type=&page=1`);
                const data = await response.json();
                if (data.Response === 'True') {
                    displayResults(data.Search);
                } else {
                    resultsContainer.innerHTML = '<p>No results found.</p>';
                }
            } catch (error) {
                console.error("Error fetching data:", error);
                resultsContainer.innerHTML = '<p style="color: #ff5555;">Failed to fetch data. Check console.</p>';
            }
        }

        // Display the results
        function displayResults(items) {
            resultsContainer.innerHTML = '';
            items.forEach(item => {
                if (item.Poster === 'N/A') return; // Skip items without a poster

                const div = document.createElement('div');
                div.classList.add('item');

                div.innerHTML = `
                    <img src="${item.Poster}" alt="${item.Title}" class="poster" data-id="${item.imdbID}" data-type="${item.Type}">
                    <div class="title">${item.Title} (${item.Year})</div>
                `;
                resultsContainer.appendChild(div);
            });

            // Add event listeners to posters
            document.querySelectorAll('.poster').forEach(poster => {
                poster.addEventListener('click', (e) => {
                    const id = e.target.getAttribute('data-id');
                    const type = e.target.getAttribute('data-type');
                    playItem(id, type);
                });
            });
        }

        // Function to fetch and play the stream
        async function playItem(id, type) {
            player.style.display = 'flex';
            videoPlayer.innerHTML = '<p>Loading stream... Please wait.</p>';

            // Use the new function to get a stream URL from popular embedder sites
            try {
                const streamUrl = await fetchStreamUrl(id, type);
                if (streamUrl) {
                    videoPlayer.src = streamUrl;
                    videoPlayer.load();
                } else {
                    videoPlayer.innerHTML = '<p>Stream not found. Try another title.</p>';
                }
            } catch (error) {
                console.error("Error fetching stream:", error);
                videoPlayer.innerHTML = '<p>Error loading stream. Check console.</p>';
            }
        }

        // NEW FUNCTION: Fetch stream URL from popular embedder sites using IMDB ID
        async function fetchStreamUrl(imdbId, type) {
            // Common video embedder sites that use IMDB IDs
            const typePath = type === 'movie' ? 'movie' : 'tv'; // Adjust path for some sites
            const embedderSites = [
                `https://autoembed.to/${typePath}/${imdbId}`,
                `https://vidsrc.me/embed/${type}?imdb=${imdbId}`,
                `https://vidsrc.xyz/embed/${type}/${imdbId}`,
                `https://embed.su/embed/${type}/${imdbId}`,
                `https://multiembed.mov/?video_id=${imdbId}&tmdb=1`
            ];

            // This function will try each site until it finds one that works
            for (const siteUrl of embedderSites) {
                try {
                    // A simple test to see if the page might exist
                    const testResponse = await fetch(siteUrl, { method: 'HEAD', mode: 'no-cors' });
                    // If we get here, the site is likely accessible
                    return siteUrl; // Return the first working URL
                } catch (error) {
                    console.log(`Site not accessible: ${siteUrl}`);
                    // Just move on to the next one
                }
            }
            // If no sites work, return a fallback
            return `https://vidsrc.me/embed/${type}?imdb=${imdbId}`; // Fallback to a common one
        }

        // Simple debounce function to limit API calls
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>
